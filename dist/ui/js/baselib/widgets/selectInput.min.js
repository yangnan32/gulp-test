zWidgets.selectInput=function(data){var selectInputObj={id:data.id,changeUrl:data.url,tagUrl:data.tagUrl,key:data.key,dataName:data.dataName,dataRoot:data.dataRoot,openEnter:data.openEnter||!0,columns:data.columns,filterId:data.filterId,vals:data.vals,valTexts:data.valTexts,maxLength:data.maxLength||0,height:data.height,tooltipCls:data.tooltipCls,textAlign:data.textAlign||"left",useToolPage:data.useToolPage||!1,inputId:data.id+"Input",btnId:data.id+"Btn",parentId:data.id+"Parent",selectDivId:data.id+"SelectDiv",tableDivId:data.id+"SelectTable",tagDivId:data.id+"TagDiv",prevBtnId:"prev"+data.id,nextBtnId:"next"+data.id,totalPageId:"totalpage"+data.id,pageId:"page"+data.id,toolPageRightId:"toolBarRight"+data.id,bbarId:"select_bbar"+data.id,dataNoneId:"dataNone"+data.id,searchName:"",totalPage:"",selectData:"",totalCount:"",start:0,limit:data.limit||"5",startPage:1,showY:0};selectInputObj.renderSelectDiv=function(){var t=parseInt($("#"+selectInputObj.parentId).width()),e="";selectInputObj.height&&null!=selectInputObj.height&&""!=selectInputObj.height&&0!=selectInputObj.height&&(e="height:"+selectInputObj.height+"px;");var a=$('<div id="'+selectInputObj.selectDivId+'" class="uiframe-selectbox-ajax uiframe-selectHide" style="width:'+t+"px;*margin-left:-"+(t+33)+'px"><div style="overflow-y:auto;overflow-x: hidden;'+e+'"><table class="uiframe-ajax-content uiframe-searchInput-table" id="'+selectInputObj.tableDivId+'"></table></div></div>'),s=$('<div class="comboxCheckboxDiv uiframe-select-bbar uiframe-searchInput-bbar" id="'+selectInputObj.bbarId+'"><div style="float: left;margin-top: 1px;"><table><tr><td class="uiframe-grid-span"></td><td><input type="button" class="searchInputClear uiframe-module-btn uiframe-module-cancel-btn" id="clearBtn'+selectInputObj.id+'" value="清空"></td><td class="uiframe-grid-span"></td></tr></table></div><div style="float:right;" id="'+selectInputObj.toolPageRightId+'"><table><tr><td><span id="'+selectInputObj.pageId+'"></span></td><td style="line-height:18px;">/</td><td><span id="'+selectInputObj.totalPageId+'"></span></td><td><div class="uiframe-grid-span"></div></td><td style="line-height:18px;"><div style="_padding-top: 4px;">页</div></td><td><div class="uiframe-grid-span"></div></td><td><input type="button" class="uiframe-module-btn" id="'+selectInputObj.prevBtnId+'" value="上一页"></td><td><div class="uiframe-grid-span"></div></td><td><input type="button" class="uiframe-module-btn" id="'+selectInputObj.nextBtnId+'" value="下一页" /></td><td class="uiframe-grid-span"></td></tr></table></div></div><div class="uiframe-select-bbar uiframe-searchInput-bbar" id="'+selectInputObj.dataNoneId+'" style="display: none;padding-left: 8px;">无数据</div>');$("#"+selectInputObj.id).parents("div.widget-selectInput").append(a),selectInputObj.useToolPage&&$("#"+selectInputObj.selectDivId).append(s);var l=$('<div class="uiframe-search-tagDiv selectInputTag" id="'+selectInputObj.tagDivId+'" style="width:'+t+'px;"></div>');$("#"+selectInputObj.id).parents("div.widget-selectInput").after(l)},selectInputObj.renderSelectDiv(),selectInputObj.initEmptyText=function(){var t=$("#"+selectInputObj.inputId);""==$("#"+selectInputObj.id).val()&&t.attr("emptyText")&&""!=t.attr("emptyText")?t.width(12*t.attr("emptyText").length+10).val(t.attr("emptyText")).addClass("uiframe-emptyTextColor"):t.width(10).val("").removeClass("uiframe-emptyTextColor")},selectInputObj.initToolBtn=function(){selectInputObj.totalPage=Math.ceil(selectInputObj.totalCount/selectInputObj.limit),$("#"+selectInputObj.pageId).text(selectInputObj.startPage),$("#"+selectInputObj.totalPageId).text(selectInputObj.totalPage),selectInputObj.totalCount<=selectInputObj.recordPage?$("#"+selectInputObj.toolPageRightId).hide():$("#"+selectInputObj.toolPageRightId).show(),0==selectInputObj.totalPage?($("#"+selectInputObj.bbarId).hide(),$("#"+selectInputObj.dataNoneId).show(),$("#"+selectInputObj.pageId).text("0")):($("#"+selectInputObj.dataNoneId).hide(),$("#"+selectInputObj.bbarId).show(),selectInputObj.startPage==selectInputObj.totalPage?$("#"+selectInputObj.nextBtnId).attr("disabled","disabled").removeClass("uiframe-module-btn-hover").addClass("uiframeTextDisabled"):$("#"+selectInputObj.nextBtnId).removeAttr("disabled","disabled").removeClass("uiframeTextDisabled")),1==selectInputObj.startPage?$("#"+selectInputObj.prevBtnId).attr("disabled","disabled").removeClass("uiframe-module-btn-hover").addClass("uiframeTextDisabled"):$("#"+selectInputObj.prevBtnId).removeAttr("disabled","disabled").removeClass("uiframeTextDisabled")},selectInputObj.loadajax_search=function(url){if(""!=selectInputObj.maxLength&&""!=$("#"+selectInputObj.id).val()&&$("#"+selectInputObj.id).val().split(",").length>=parseInt(selectInputObj.maxLength))return $("#"+selectInputObj.selectDivId).hide(),$("#"+selectInputObj.inputId).val(""),$("#"+selectInputObj.id).trigger("errorMsg"),!1;var params={start:selectInputObj.start,limit:selectInputObj.limit,limitId:""!=selectInputObj.filterId?selectInputObj.filterId+","+$("#"+selectInputObj.id).val():$("#"+selectInputObj.id).val()},hidevalue=$("#"+selectInputObj.id).val(),columns=eval("("+selectInputObj.columns+")"),columnlength=columns.length;selectInputObj.searchName=selectInputObj.searchName.replace(/%/g,"%25"),selectInputObj.searchName=selectInputObj.searchName.replace(/\&/g,"%26"),selectInputObj.searchName=selectInputObj.searchName.replace(/\+/g,"%2B"),selectInputObj.searchName=selectInputObj.searchName.replace(/\?/g,"%3F"),params[selectInputObj.dataName]=selectInputObj.searchName;var _url="";_url=-1!=url.indexOf("?")?url+"&":url+"?",_url+="start="+selectInputObj.start+"&limit="+selectInputObj.limit+"&"+selectInputObj.dataName+"="+selectInputObj.searchName,$.ajax({type:"GET",url:_url,dataType:"json",data:"",success:function(data_name){if(data_name){var datas;if(void 0==(datas=selectInputObj.dataRoot&&""!=selectInputObj.dataRoot?eval("data_name."+selectInputObj.dataRoot)||[]:eval("data_name")||[]))return;selectInputObj.totalCount=datas.recordtotal||0,selectInputObj.selectData=datas.resultSet||[]}var table=$("#"+selectInputObj.tableDivId);table.find("tbody").empty();for(var tdW=$("#"+selectInputObj.selectDivId).width()/columnlength-12,i=0;i<selectInputObj.selectData.length;i++){var record=selectInputObj.selectData[i];if(record){for(var columnKey=record[selectInputObj.key],tr=$('<tr class="syswareSearchLi click-ajax-tr" val="'+columnKey+'"></tr>'),k=0;k<columnlength;k++){var column=columns[k],dataIndex=column.dataIndex,showValue=column.showValue,data=record[dataIndex]||"";1==showValue?tr.append('<td style="text-align:'+selectInputObj.textAlign+'" class="searchText"><div class="uiframe-searchCombo-td '+selectInputObj.tooltipCls+'" myTitle="'+data+'" style="width:'+tdW+'px;">'+data+"</div></td>"):tr.append('<td style="text-align:'+selectInputObj.textAlign+'"><div class="uiframe-searchCombo-td '+selectInputObj.tooltipCls+'" myTitle="'+data+'" style="width:'+tdW+'px;">'+data+"</div></td>")}table.append(tr)}}if(selectInputObj.initToolBtn(),$("#"+selectInputObj.tableDivId).find("td").each(function(){$(this).attr("value")==hidevalue&&$(this).parent("tr").addClass("uiframe-selected")}),""==selectInputObj.showY||"0"==selectInputObj.showY)return!1;var $showDiv=$("#"+selectInputObj.selectDivId),showH=$showDiv.height(),bodyH=$(window).height();$showDiv.css("margin-top",$("#"+selectInputObj.parentId).height()+2)},error:function(t,e,a){}})},selectInputObj.loadTag=function(url){if(!url||""==url)return!1;$.ajax({type:"GET",url:url,dataType:"json",data:{},success:function(data_name){if(data_name){var datas;if(void 0==(datas=selectInputObj.dataRoot&&""!=selectInputObj.dataRoot?eval("data_name."+selectInputObj.dataRoot)||[]:eval("data_name")||[]))return;selectInputObj.totalCount=datas.recordtotal||0,selectInputObj.selectData=datas.resultSet||[]}var $tagDiv=$("#"+selectInputObj.tagDivId);$tagDiv.empty(),selectInputObj.selectData.length>0&&$tagDiv.text("标签:");for(var i=0;i<selectInputObj.selectData.length;i++){var record=selectInputObj.selectData[i];if(record){var columnKey=record[selectInputObj.key],columnVal=record.name,$span=$('<a href="javascript:void(0);" val="'+columnKey+'">'+columnVal+"</a>");$tagDiv.append($span)}}},error:function(t,e,a){}})},selectInputObj.setValue=function(t,e){if(""!=t&&""!=e)for(var a=t.split(","),s=e.split(","),l=0,r=a.length;l<r;l++){var n='<div class="uiframe-search-selectLayout searchSelectLayout"><div class="uiframe-search-inputDiv searchInsertInput"></div><div class="uiframe-search-selectDiv searchSelectDiv"><div class="uiframe-search-name search-selectData" keyVal="'+a[l]+'">'+s[l]+'</div><div class="uiframe-search-delete search-deleteData"></div></div></div>';$("#"+selectInputObj.inputId).before(n)}},selectInputObj.addError=function(){var t=$("#"+selectInputObj.parentId).parent(),e=$("#"+selectInputObj.parentId),a=$("#"+selectInputObj.btnId);if(t.data("errortext")&&""==$("#"+selectInputObj.id).val()){e.addClass("error"),a.addClass("error"),t.parent().find("label.error")&&t.parent().find("label.error").remove();var s=$('<label for="n" generated="true" class="error">'+t.data("errortext")+"</label>");t.parent().append(s)}},selectInputObj.addCHError=function(){var t=$("#"+selectInputObj.parentId).parent(),e=$("#"+selectInputObj.parentId),a=$("#"+selectInputObj.btnId);if(t.data("errortext")){e.addClass("error"),a.addClass("error"),t.parent().find("label.error")&&t.parent().find("label.error").remove();var s=$('<label for="n" generated="true" class="error">'+t.data("errortext")+"</label>");t.parent().append(s)}},selectInputObj.removeError=function(){var t=$("#"+selectInputObj.parentId).parent(),e=$("#"+selectInputObj.parentId),a=$("#"+selectInputObj.btnId);e.removeClass("error"),a.removeClass("error"),t.parent().find("label.error").remove()},$("#"+selectInputObj.id).on("addError",function(){selectInputObj.addError()}).on("removeError",function(){selectInputObj.removeError()}).on("addCHError",function(){selectInputObj.addCHError()}),$(document).on("focus","#"+selectInputObj.inputId,function(){$("#"+selectInputObj.parentId).find(".searchSelectDiv").removeClass("uiframe-search-selectDiv-select"),$(this).width(10).val("").removeClass("uiframe-emptyTextColor")}).on("keyup.searchInput","#"+selectInputObj.inputId,function(t){var e=$(this),a=$("#"+selectInputObj.id),s=$("#"+selectInputObj.parentId),l=$("#"+selectInputObj.selectDivId);if(selectInputObj.showY=$(t.target).offset().top,t.ctrlKey||t.shiftKey||16==t.keyCode||17==t.keyCode)return!1;if(40!==t.keyCode&&39!==t.keyCode&&38!==t.keyCode&&37!==t.keyCode&&27!==t.keyCode){if(13===t.keyCode&&""!=$.trim(e.val())&&selectInputObj.openEnter){var r=$.trim(e.val()),n=$('<div class="uiframe-search-selectLayout searchSelectLayout"><div class="uiframe-search-inputDiv searchInsertInput"></div><div class="uiframe-search-selectDiv searchSelectDiv"><div class="uiframe-search-name search-selectData" keyVal="0">'+r+'</div><div class="uiframe-search-delete search-deleteData"></div></div></div>');return e.before(n),e.val("").hide(),a.attr("text",""),s.find("div.search-selectData").each(function(){""==a.val()?(a.attr("text",$(this).text()),a.attr("texts",$(this).text())):(a.attr("text",a.attr("text")+$(this).text()),a.attr("texts",a.attr("text")+","+$(this).text()))}),l.hide(),selectInputObj.removeError(),a.trigger("enterAfter",[r,n]),!1}if(e.width(12*e.val().length+10),""==e.val()&&8===t.keyCode)return $("#"+selectInputObj.selectDivId).hide(),1==$("#"+selectInputObj.parentId).find(".uiframe-search-selectDiv-select").length&&$("#"+selectInputObj.parentId).find(".uiframe-search-selectDiv-select").find(".search-deleteData").trigger("click"),e.prev("div")&&e.prev("div").find(".searchSelectDiv").addClass("uiframe-search-selectDiv-select"),!1;$("#"+selectInputObj.parentId).find(".searchSelectDiv").removeClass("uiframe-search-selectDiv-select"),selectInputObj.searchName=e.val(),selectInputObj.startPage=1,selectInputObj.start=0,selectInputObj.loadajax_search(selectInputObj.changeUrl),(""==selectInputObj.maxLength||""==$("#"+selectInputObj.id).val()||$("#"+selectInputObj.id).val().split(",").length>=parseInt(selectInputObj.maxLength))&&($("#"+selectInputObj.selectDivId).css("z-index",zWidgets.selection_zindex).show(),zWidgets.selection_zindex++)}}).on("blur","#"+selectInputObj.inputId,function(){$("#"+selectInputObj.parentId).find(".searchSelectDiv").removeClass("uiframe-search-selectDiv-select"),0==$(this).find(".uiframe-search-selectDiv").length?$("#"+selectInputObj.inputId).show():$("#"+selectInputObj.inputId).hide(),selectInputObj.initEmptyText()}).on("click","#"+selectInputObj.tagDivId+" a",function(){var t=1;if(-1!=(s=$("#"+selectInputObj.id).val()).indexOf(",")&&(t=s.split(",").length),""==s&&(t=0),selectInputObj.maxLength&&"0"!=selectInputObj.maxLength&&t>=parseInt(selectInputObj.maxLength))return!1;if(!$(this).hasClass("uiframe-tagClick")){$("#"+selectInputObj.inputId).hasClass("uiframe-emptyTextColor")&&$("#"+selectInputObj.inputId).trigger("focus");var e=$("#"+selectInputObj.id),a=$("#"+selectInputObj.parentId),s=e.val(),l=$(this).attr("val");-1==s.indexOf(l)&&(selectInputObj.setValue(l,$(this).text()),selectInputObj.removeError(),e.val(""),e.attr("text",""),a.find("div.search-selectData").each(function(){""==e.val()?(e.val($(this).attr("keyVal")),e.attr("text",$(this).text()),e.attr("texts",$(this).text())):(e.val(e.val()+","+$(this).attr("keyVal")),e.attr("text",e.attr("text")+$(this).text()),e.attr("texts",e.attr("text")+","+$(this).text()))}))}}),$("#"+selectInputObj.id).on("initEmptyText",function(){selectInputObj.initEmptyText()}),$("#"+selectInputObj.selectDivId).on("searchAction",function(){selectInputObj.searchName="",selectInputObj.startPage=1,selectInputObj.start=0,selectInputObj.loadajax_search(selectInputObj.changeUrl)}),$("#"+selectInputObj.id).on("setUrl",function(t,e){selectInputObj.changeUrl=e,selectInputObj.loadajax_search(e)}).on("setValue",function(t,e,a){selectInputObj.setValue(e,a)}),$("#"+selectInputObj.toolPageRightId).on("click","input",function(t){switch($(t.target).attr("id")){case selectInputObj.prevBtnId:selectInputObj.startPage=parseInt(selectInputObj.startPage)-1;break;case selectInputObj.nextBtnId:selectInputObj.startPage=parseInt(selectInputObj.startPage)+1}selectInputObj.start=(selectInputObj.startPage-1)*selectInputObj.limit,selectInputObj.loadajax_search(selectInputObj.changeUrl)}),selectInputObj.loadTag(selectInputObj.tagUrl),selectInputObj.initEmptyText(),selectInputObj.setValue(selectInputObj.vals,selectInputObj.valTexts),$("#"+selectInputObj.id).parents("div.widget-selectInput").attr("data-parserFlag",!0)},$(function(){zWidgets._document.on("click",".syswareSearchInput",function(t){var e=$(this).parents("div.widget-selectInput"),a=$("#"+e.data("id")+"SelectDiv");if("block"==a.css("display"))a.css("display","none");else{a.height(),$(window).height();a.css("margin-top",$("#"+e.data("id")+"Parent").height()+2),$("body").find(".uiframe-selectHide").hide(),a.css("display","block").css("z-index",zWidgets.selection_zindex),a.trigger("searchAction",[""]),$(this).attr("tabindex",0).focus(),zWidgets.selection_zindex++}return!1}).on("click",".syswareSearchLi",function(){var t=$(this),e=t.parents("div.widget-selectInput"),a=$("#"+e.data("id")),s=$("#"+e.data("id")+"Parent"),l=$("#"+e.data("id")+"Input"),r=$("#"+e.data("id")+"SelectDiv"),n=t.children("td.searchText").text(),i=a.val(),c=t.attr("val");if(-1==i.indexOf(c)){var d='<div class="uiframe-search-selectLayout searchSelectLayout"><div class="uiframe-search-inputDiv searchInsertInput"></div><div class="uiframe-search-selectDiv searchSelectDiv"><div class="uiframe-search-name search-selectData" keyVal="'+c+'">'+n+'</div><div class="uiframe-search-delete search-deleteData"></div></div></div>';l.before(d),l.val("").hide(),a.trigger("removeError"),a.val(""),a.attr("text",""),s.find("div.search-selectData").each(function(){""==a.val()?(a.val($(this).attr("keyVal")),a.attr("text",$(this).text()),a.attr("texts",$(this).text())):(a.val(a.val()+","+$(this).attr("keyVal")),a.attr("text",a.attr("text")+$(this).text()),a.attr("texts",a.attr("text")+","+$(this).text()))})}return r.hide(),a.trigger("initEmptyText"),a.trigger("change",[a.val(),a.attr("text")]),!1}).on("click",".search-deleteData",function(){var t=$(this).parents("div.widget-selectInput"),e=$("#"+t.data("id")+"Parent"),a=$("#"+t.data("id"));return $(this).parents("div.searchSelectLayout").remove(),a.val(""),a.attr("text",""),e.find("div.search-selectData").each(function(){""==a.val()?(a.val($(this).attr("keyVal")),a.attr("text",$(this).text())):(a.val(a.val()+","+$(this).attr("keyVal")),a.attr("text",a.attr("text")+","+$(this).text()))}),0==e.find(".uiframe-search-selectData").length?e.find("input.uiframe-search-text").show():e.find("input.uiframe-search-text").hide(),""==a.val()&&a.trigger("addError"),a.trigger("initEmptyText"),a.trigger("change",[a.val(),a.attr("text")]),!1}).on("click",".searchInsertInput",function(){var t=$(this).parents("div.widget-selectInput"),e=$("#"+t.data("id")+"Input");return $(this).next().hasClass("uiframe-search-text")||($(this).parent("div.searchSelectLayout").before(e),e.width(10).val("").show().trigger("focus")),!1}).on("click",".searchSelectDiv",function(){var t=$(this).parents("div.widget-selectInput"),e=$("#"+t.data("id")+"Parent");return e.find(".searchSelectDiv").removeClass("uiframe-search-selectDiv-select"),$(this).addClass("uiframe-search-selectDiv-select"),e.attr("tabindex",0).focus(),!1}).on("click",".searchInputClear",function(){var t=$(this).parents("div.widget-selectInput"),e=$("#"+t.data("id")),a=$("#"+t.data("id")+"Parent");return e.val(""),a.find(".searchSelectLayout").remove(),a.find("input.uiframe-search-text").show(),e.trigger("removeError"),e.trigger("initEmptyText"),e.trigger("change",["",""]),!1}).on("click",".uiframe-mainCon-search",function(){var t=$(this).parents("div.widget-selectInput"),e=$("#"+t.data("id")+"Input");return $(this).append(e),e.show().trigger("focus"),!1}).on("mouseover",".searchSelectDiv",function(){$(this).addClass("uiframe-search-selectDiv-hover")}).on("mouseout",".searchSelectDiv",function(){$(this).removeClass("uiframe-search-selectDiv-hover")}).on("mouseover",".uiframe-search-btn",function(){$(this).addClass("uiframe-search-btn-hover")}).on("mouseout",".uiframe-search-btn",function(){$(this).removeClass("uiframe-search-btn-hover")})});